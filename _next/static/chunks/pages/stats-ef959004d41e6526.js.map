{"version":3,"file":"static/chunks/pages/stats-ef959004d41e6526.js","mappings":"qFACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,SACA,WACA,OAAeC,EAAQ,MACvB,EACA,8JCEO,IAAMC,EAAW,GAEpB,GAAAC,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,YAAa,wBACjC,GAAAL,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,UAAW,8BAC/B,GAAAL,EAAAM,IAAA,EAACJ,MAAAA,CAAIC,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,2BACpB,GAAAL,EAAAC,GAAA,EAACM,SAAAA,CACCJ,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,iBAAkB,YACnCG,MAAO,CAAEC,UAAW,QAAS,WAE5BC,EAAMC,KAAK,GAEd,GAAAX,EAAAC,GAAA,EAACW,KAAAA,CAAGT,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,iBAAkB,qBAAcK,EAAMG,KAAK,GAC/DH,EAAMI,WAAW,EAChB,GAAAd,EAAAC,GAAA,EAACC,MAAAA,CAAIC,UAAWC,EAAAA,EAAEA,CAACC,EAAE,CAAC,0BACpB,GAAAL,EAAAC,GAAA,EAACc,IAAAA,UAAGL,EAAMI,WAAW,YChBtBE,EAAkB,cAcdC,EACIA,EACPC,EAXZ,IAAMC,EAAWC,CAHd,GAA0FC,MAAAA,CAAxFA,6BAAmC,uDAA4FC,MAAA,CAAvCD,MAAuC,uCACjI,GAA8EA,MAAAA,CAA5EA,6BAAmC,2CAAgFC,MAAA,CAAvCD,MAAuC,uCACvH,CAC2BE,GAAG,CAAC,GAC9BC,MAAMC,GACHC,IAAI,CAAC,GAAUC,EAAKC,IAAI,IACxBC,KAAK,CAAC,IACE,OAGP,CAACX,EAAaD,EAAS,CAAG,MAAMa,QAAQC,GAAG,CAACZ,GAClD,MAAO,CACLa,YAAaf,OAAAA,CAAAA,EAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAUgB,YAAY,GAAtBhB,KAAAA,IAAAA,EAAAA,EAA0B,EACvCiB,gBAAiBjB,OAAAA,CAAAA,EAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAUkB,iBAAiB,GAA3BlB,KAAAA,IAAAA,EAAAA,EAA+B,EAChDmB,SAAUlB,OAAAA,CAAAA,EAAAA,MAAAA,EAAAA,KAAAA,EAAAA,EAAamB,KAAK,GAAlBnB,KAAAA,IAAAA,EAAAA,EAAsB,CAClC,CACF,ECtBMoB,EAAgB,IACpB,GAAM,CAACC,EAAOC,EAAS,CAAGC,CAAAA,EAAAA,EAAAA,QAAAA,EAAS,IAC7BC,EAAQ,KAER,SAAU/C,QAAUA,OAAOgD,IAAI,CAACC,MAAM,CACxCJ,EAAS,IAETK,WAAWH,EAAO,GAEtB,QAOA,CANAI,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACHP,GACHG,GAEJ,GAEKH,GAIE7B,EAAMqC,QAAQ,CAHZ,IAIX,EAuBaC,EAAe,GAC1B,GAAAhD,EAAAC,GAAA,EAACqC,EAAAA,UACC,GAAAtC,EAAAC,GAAA,EAACgD,gBAAAA,CAAe,GAAGvC,CAAK,KAIfwC,EAAW,GACtB,GAAAlD,EAAAC,GAAA,EAACqC,EAAAA,UACC,GAAAtC,EAAAC,GAAA,EAACkD,YAAAA,CAAW,GAAGzC,CAAK,KCwBxB,IAAAC,EApEwB,KAEtB,GAAM,CAACyC,EAAYC,EAAc,CAAGC,EAAAA,QAAc,CAAe,CAC/DtB,YAAa,EACbI,SAAU,EACVF,gBAAiB,CACnB,GAEAY,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,KACP,WAECO,EADa,MAAMrC,IAErB,IACF,EAAG,EAAE,EAEL,IAAMuC,EAAWlC,mBACjB,MACE,GAAArB,EAAAM,IAAA,EAAAN,EAAAwD,QAAA,YACE,GAAAxD,EAAAC,GAAA,EAACwD,IAAMA,CAACC,IAAK,GAAYpC,MAAA,CAATiC,EAAS,+BACzB,GAAAvD,EAAAM,IAAA,EAACqD,IAAIA,WACH,GAAA3D,EAAAC,GAAA,EAACY,QAAAA,UAAM,0CACP,GAAAb,EAAAC,GAAA,EAAC2D,OAAAA,CAAKC,IAAI,aAAaC,KAAM,GAAYxC,MAAA,CAATiC,EAAS,+BAE3C,GAAAvD,EAAAM,IAAA,EAACJ,MAAAA,CAAIC,UAAU,mCACb,GAAAH,EAAAC,GAAA,EAAC8D,KAAAA,UAAG,cACJ,GAAA/D,EAAAM,IAAA,EAACJ,MAAAA,CAAIC,UAAU,iEACb,GAAAH,EAAAC,GAAA,EAACF,EAAQA,CACPc,MAAM,oBACNF,MAAOyC,EAAWhB,QAAQ,CAC1BtB,YAAY,sEAEd,GAAAd,EAAAC,GAAA,EAACF,EAAQA,CACPc,MAAM,+BACNF,MAAOyC,EAAWpB,WAAW,CAC7BlB,YAAY,gFAEd,GAAAd,EAAAC,GAAA,EAACF,EAAQA,CACPc,MAAM,iCACNF,MAAOyC,EAAWlB,eAAe,CACjCpB,YAAY,kFAGhB,GAAAd,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,GACD,GAAAhE,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,GACD,GAAAhE,EAAAC,GAAA,EAAC8D,KAAAA,UAAG,0BACJ,GAAA/D,EAAAC,GAAA,EAAC+C,EAAYA,CACXiB,EAAGC,KAAKC,SAAS,CAAC,CAChB,CAAC,EAAG,EAAG,EAAE,CACT,CAAC,EAAG,EAAG,GAAG,CACX,EACDC,EAAGF,KAAKC,SAAS,CAAC,CAChB,CAAC,GAAI,GAAI,GAAG,CACZ,CAAC,GAAI,GAAI,GAAG,CACb,IAEH,GAAAnE,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,GACD,GAAAhE,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,GACD,GAAAhE,EAAAC,GAAA,EAACiD,EAAQA,CACPe,EAAGC,KAAKC,SAAS,CAAC,CAAC,EAAG,EAAG,EAAE,EAC3BC,EAAGF,KAAKC,SAAS,CAAC,CAAC,GAAI,GAAI,GAAG,IAEhC,GAAAnE,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,GACD,GAAAhE,EAAAC,GAAA,EAAC+D,KAAAA,CAAAA,QAIT,wBC5EAK,EAAAC,OAAA,CAAAxE,EAAA","sources":["webpack://_N_E/?558b","webpack://_N_E/./src/components/StatTile.tsx","webpack://_N_E/./src/lib/matomo.ts","webpack://_N_E/./src/components/DsFrChart.tsx","webpack://_N_E/./src/pages/stats.tsx","webpack://_N_E/./node_modules/next/script.js"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/stats\",\n      function () {\n        return require(\"private-next-pages/stats.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/stats\"])\n      });\n    }\n  ","import { fr } from \"@codegouvfr/react-dsfr\";\n\nexport type StatTileProps = {\n  title: string;\n  stats: string | number;\n  description?: string | React.ReactNode;\n};\n\nexport const StatTile = (props: StatTileProps): JSX.Element => {\n  return (\n    <div className={fr.cx(\"fr-col-12\", \"fr-col-md-4\")}>\n      <div className={fr.cx(\"fr-card\", \"fr-card--no-arrow\")}>\n        <div className={fr.cx(\"fr-card__body\")}>\n          <strong\n            className={fr.cx(\"fr-display--md\", \"fr-mt-5w\")}\n            style={{ textAlign: \"center\" }}\n          >\n            {props.stats}\n          </strong>\n          <h2 className={fr.cx(\"fr-card__title\", \"fr-mb-4w\")}>{props.title}</h2>\n          {props.description && (\n            <div className={fr.cx(\"fr-card__desc\")}>\n              <p>{props.description}</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","export type MatomoResult = {\n  nbPageViews: number;\n  nbUniqPageViews: number;\n  nbVisits: number;\n};\n\nexport const fetchMatomoData = async (): Promise<MatomoResult> => {\n  const MATOMO_URL = [\n    `${process.env.NEXT_PUBLIC_MATOMO_URL}/?module=API&method=VisitsSummary.getVisits&idSite=${process.env.NEXT_PUBLIC_MATOMO_SITE_ID}&format=JSON&period=year&date=today`,\n    `${process.env.NEXT_PUBLIC_MATOMO_URL}/?module=API&method=Actions.get&idSite=${process.env.NEXT_PUBLIC_MATOMO_SITE_ID}&format=JSON&period=year&date=today`,\n  ];\n  const promises = MATOMO_URL.map((url) =>\n    fetch(url)\n      .then((data) => data.json())\n      .catch(() => {\n        return null;\n      })\n  );\n  const [nbVisitData, infoData] = await Promise.all(promises);\n  return {\n    nbPageViews: infoData?.nb_pageviews ?? 0,\n    nbUniqPageViews: infoData?.nb_uniq_pageviews ?? 0,\n    nbVisits: nbVisitData?.value ?? 0,\n  };\n};\n","import React, { useEffect, useState } from \"react\";\n\nconst MiseryWrapper = (props: any) => {\n  const [ready, setReady] = useState(false);\n  const check = () => {\n    // @ts-ignore\n    if (\"dsfr\" in window && window.dsfr.colors) {\n      setReady(true);\n    } else {\n      setTimeout(check, 50);\n    }\n  };\n  useEffect(() => {\n    if (!ready) {\n      check();\n    }\n  });\n\n  if (!ready) {\n    return null;\n  }\n\n  return props.children;\n};\n\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      \"scatter-chart\": ScatterChartAttributes;\n      \"pie-chart\": PieChartAttributes;\n    }\n  }\n}\n\n// https://github.com/GouvernementFR/dsfr-chart/blob/main/src/components/ScatterChart.vue#L75\ninterface ScatterChartAttributes {\n  x: string;\n  y: string;\n}\n\n// https://github.com/GouvernementFR/dsfr-chart/blob/main/src/components/PieChart.vue#L59\ninterface PieChartAttributes {\n  x: string;\n  y: string;\n}\n\nexport const ScatterChart = (props: ScatterChartAttributes) => (\n  <MiseryWrapper>\n    <scatter-chart {...props} />\n  </MiseryWrapper>\n);\n\nexport const PieChart = (props: PieChartAttributes) => (\n  <MiseryWrapper>\n    <pie-chart {...props} />\n  </MiseryWrapper>\n);\n","import React, { useEffect } from \"react\";\nimport type { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport Script from \"next/script\";\nimport { StatTile } from \"../components/StatTile\";\n\nimport { fetchMatomoData, MatomoResult } from \"../lib\";\n\nimport { ScatterChart, PieChart } from \"../components/DsFrChart\";\n\nconst Stats: NextPage = () => {\n  // fetch stats from public matomo\n  const [matomoData, setMatomoData] = React.useState<MatomoResult>({\n    nbPageViews: 0,\n    nbVisits: 0,\n    nbUniqPageViews: 0,\n  });\n\n  useEffect(() => {\n    (async () => {\n      const data = await fetchMatomoData();\n      setMatomoData(data);\n    })();\n  }, []);\n\n  const basePath = process.env.NEXT_PUBLIC_BASE_PATH;\n  return (\n    <>\n      <Script src={`${basePath}/Charts/dsfr-chart.umd.js`} />\n      <Head>\n        <title>Statistiques d&apos;utilisation | template</title>\n        <link rel=\"stylesheet\" href={`${basePath}/Charts/dsfr-chart.css`} />\n      </Head>\n      <div className=\"fr-container fr-my-10w\">\n        <h1>Usage web</h1>\n        <div className=\"fr-grid-row fr-grid-row--gutters fr-grid-row--center\">\n          <StatTile\n            title=\"Nombre de visites\"\n            stats={matomoData.nbVisits}\n            description=\"C'est le nombre de visites total du site sur les 12 derniers mois\"\n          />\n          <StatTile\n            title=\"Nombre de pages vues (total)\"\n            stats={matomoData.nbPageViews}\n            description=\"C'est le nombre de pages vues au total sur le site sur les 12 derniers mois\"\n          />\n          <StatTile\n            title=\"Nombre de pages vues (uniques)\"\n            stats={matomoData.nbUniqPageViews}\n            description=\"C'est le nombre de pages vues uniques sur le site sur les 12 derniers mois\"\n          />\n        </div>\n        <br />\n        <br />\n        <h1>Statistiques d&apos;impact</h1>\n        <ScatterChart\n          x={JSON.stringify([\n            [1, 5, 8],\n            [1, 2, 15],\n          ])}\n          y={JSON.stringify([\n            [30, 10, 20],\n            [10, 20, 30],\n          ])}\n        ></ScatterChart>\n        <br />\n        <br />\n        <PieChart\n          x={JSON.stringify([1, 2, 3])}\n          y={JSON.stringify([10, 20, 30])}\n        ></PieChart>\n        <br />\n        <br />\n      </div>\n    </>\n  );\n};\n\nexport default Stats;\n","module.exports = require('./dist/client/script')\n"],"names":["window","__NEXT_P","push","__webpack_require__","StatTile","jsx_runtime","jsx","div","className","fr","cx","jsxs","strong","style","textAlign","props","stats","h2","title","description","p","fetchMatomoData","infoData","nbVisitData","promises","MATOMO_URL","process","concat","map","fetch","url","then","data","json","catch","Promise","all","nbPageViews","nb_pageviews","nbUniqPageViews","nb_uniq_pageviews","nbVisits","value","MiseryWrapper","ready","setReady","useState","check","dsfr","colors","setTimeout","useEffect","children","ScatterChart","scatter-chart","PieChart","pie-chart","matomoData","setMatomoData","React","basePath","Fragment","Script","src","Head","link","rel","href","h1","br","x","JSON","stringify","y","module","exports"],"sourceRoot":""}